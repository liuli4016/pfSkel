<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
  <title>pfSkel</title>
</head>
<body
 style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 153);"
 link="#ffff00" vlink="#ff6600" alink="#ff0000">
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <br>
<h1>&nbsp;&nbsp;<span style="font-weight: bold;">&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; pfSkel: Potential Field Based 3D
Skeleton Extraction</span></h1>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <br>
<h2>&nbsp;TABLE OF CONTENTS:</h2>
<ol>
  <li><a href="#Description">Description
of pfSkel
and Component Modules</a></li>
  <li><a href="#Installation">Installation Notes</a></li>
  <li><a href="#WhyUseSeparately">Why Use the
Modules Separately
?</a>&nbsp;&nbsp;&nbsp; </li>
  <li><a href="#HowToUse">How to Use the
Independent
Modules</a><br>
  </li>
  <li><a href="#Saving">Saving/Loading the
Potential Field to/from a File</a></li>
  <li><a href="#Contact">Contact Info</a></li>
</ol>
&nbsp;&nbsp;&nbsp; <br>
<h2><a name="Description" class="mozTocH2"></a>1. Description of pfSkel
and component modules</h2>
<br>
&nbsp;&nbsp; <span style="font-weight: bold;">pfSkel</span> is a
collection of independent modules that perform
the different tasks of the skeletonization algorithm. The modules are
linked together
in a single executable called pfSkel, but they can be used separately
as
well. Each module has a driver program that just takes the parameters
from the
command line, passes them to the module, and then outputs the result in
a file.<br>
&nbsp;&nbsp; Some of the modules use the JAMA/C++ and TNT libraries for
eigenvalues/eigenvectors calculation.<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; TNT (Template Numerical Toolkit) and JAMA/C++ libraries
were developed at Mathematical and Computational Sciences Division of
The National
Institute of Standards and Technology &lt;&lt; http://math.nist.gov/tnt
&gt;&gt;<br>
&nbsp;&nbsp; The libraries are included in the archive under the JAMA
and TNT directories and do not require installation.<br>
<br>
<br>
<span style="font-weight: bold;">List of modules:</span><br>
<br>
&nbsp;&nbsp;<span style="font-weight: bold; text-decoration: underline;">
MakeSolidVol</span> - makes a 3D volume solid (i.e. no holes
inside)<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp;&nbsp;&nbsp;&nbsp; volume file name
(format: unsigned char, no header), volume size, <br>
&nbsp;&nbsp;&nbsp; - [output]&nbsp;&nbsp; solid volume file name
(format: unsigned char, no header).<br>
&nbsp;&nbsp; <br>
<br>
&nbsp;&nbsp; <span
 style="font-weight: bold; text-decoration: underline;">ExpandVol</span>
- adds extra layers of voxels at the surface of
the 3D object.<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp;&nbsp;&nbsp; volume
file name (format: unsigned char, no header), volume size, number of
layers to add.<br>
&nbsp;&nbsp;&nbsp; - [output]&nbsp; new volume file name (format:
unsigned char, no header).<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; <span
 style="font-weight: bold; text-decoration: underline;">PotField</span>
- computes the potential based vector field of
the 3D object.<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp;&nbsp;&nbsp; &nbsp; volume file name
(format: unsigned char, no header), volume size, field strength
(integer: 4 - 10), optional In/Out flag<br>
&nbsp;&nbsp;&nbsp; - [output]&nbsp;&nbsp;&nbsp; vector field file
(format: 3
float values for each voxel, no header).<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; <span
 style="font-weight: bold; text-decoration: underline;">CritPts</span>
- finds the critical points of a vector field.<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp;&nbsp;&nbsp; &nbsp;volume
file name (format: unsigned char, no header), volume size, vector field
file (as generated by PotField module), optional In/Out flag<br>
&nbsp;&nbsp;&nbsp; - [output]&nbsp;&nbsp; critical points list (format:
each critical point on a separate line: <br>
<ul style="margin-left: 40px;">
  <li>point coordinates (3 float values), </li>
  <li>type (1 - saddle point, 2 - attracting node,
3 - repelling node, 4 - unknown),</li>
  <li>3 eigenvalues of the Jacobian matrix evaluated at the critical
point,</li>
  <li>3 eigenvectors of the Jacobian matrix evaluated at the critical
point (3 float values for each vector)</li>
</ul>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; <span
 style="font-weight: bold; text-decoration: underline;">HighDiverg</span>
- finds the points with the highest negative
divergence values of the vector field.<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp; volume file name
(format: unsigned char, no header), volume size, vector field file (as
generated by PotField module), percentage of high divergence points to
return. Top .. % of the highest negative divergence points will be
returned, optional In/Out flag<br>
&nbsp;&nbsp;&nbsp; - [output] high divergence points list
(format: <br>
<ul style="list-style-type: disc;">
  <ul style="list-style-type: disc;">
    <li>point coordinates (3 float values)</li>
  </ul>
</ul>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br>
<br>
&nbsp;&nbsp; <span
 style="font-weight: bold; text-decoration: underline;">StreamLn</span>
- follows the streamlines starting at critical
and high divergence points.<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp; volume file name
(format: unsigned char, no header), volume size, vector field file (as
generated by PotField module),&nbsp;
critical points file (as generated by CritPts module), high divergence
points file (as generated by the HighDiverg module).<br>
&nbsp;&nbsp;&nbsp; - [output] skeleton points. format: <br>
<ul style="margin-left: 40px;">
  <li>point coordinates (3 float values)</li>
  <li>skeleton segment (1 integer value)</li>
  <li>1 float value that should be ignored.</li>
</ul>
<br>
<br>
&nbsp;&nbsp; In addition to all the separate modules, pfSkel is a
program that encapsulates the functionality of all the modules, in a
single working
program, with a few parameters:<br>
&nbsp;&nbsp;&nbsp; - [input]&nbsp; volume file name
(format: unsigned char, no header), volume size, distance of electrical
charges from object boundary, field strength, percentage of highest
divergence points to use, <br>
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; optional parameters:
interactive mode, save the vector field to a file, load the vector
field from a file, output skeleton as lines between joints instead of
points, <br>
&nbsp;&nbsp;&nbsp; - [output] skeleton file name (format:
as described for the StreamLn module above).<br>
&nbsp;&nbsp;&nbsp; <br>
<br>
<h2><a name="Installation"></a>2. Installation Notes</h2>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; 1. decompress the archive in an empty directory<br>
&nbsp;&nbsp; If you want to use pfSkel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. type: "make pfSkel"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. -<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. -<br>
&nbsp;&nbsp; If you want to use the separate modules <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. type: "cd Scripts"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. type: "./makeallmodules.sh"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. type: "cd .."<br>
&nbsp;&nbsp; 5. You are ready to go.<br>
<br>
<br>
<h2><a name="WhyUseSeparately"></a>3. Why Use the Modules Separately ?</h2>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; pfSkel encapsulates the functionality of all the modules
in a single easy to use program. So why would anybody want to use the
modules separately
? <br>
&nbsp;&nbsp; Getting the right skeleton is an iterative process. But
most often, the phases that need to be repeated are the last 2: getting
a number of
high divergence points and using those in skeleton&nbsp; generation.
pfSkel runs all the stages of the process again even if
you change just one parameter, and that may take some time. Running
only the last 2 modules
(getting high divergence points (HighDiverg) and constructing the
skeleton (StreamLn)) multiple times can save you a lot of time,
especially for
large datasets (see section&nbsp; <a href="#HowToUse">4. How to Use
the Iindependent Modules</a><br>
of this
document). Since the part that takes most of the running time is the
potential field computation, if you decide on a field strength, you can
modify the
other parameters of the program without computing the potential field
again
(see section <a href="#Saving">5. Saving/Loading the Potential Field
to/from
a File </a>of this
document).<br>
<br>
<h2><a name="HowToUse"></a>4. How to Use the Iindependent Modules</h2>
&nbsp;&nbsp; <br>
&nbsp;&nbsp; Follow the installation instruction for the "If you want
to use the separate modules" section.<br>
&nbsp;&nbsp; Each module has it's own driver program located in the
module's directory, called driver. This driver program just reads in
the command line
arguments, passes them on to the module and then outputs the result to
a file. See
module description in <a href="#Description">section 1</a> of this
document. Additionally, if you just
run the driver program with no parameters, or the wrong number of
parameters,
the program will list the required parameters.<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp; Modules should be run in the following order.<br>
<ol>
  <li>&nbsp;&nbsp; MakeSolidVol - creates a solid volume, making sure
there
are no holes in the dataset. You can skip this module if you are sure
the dataset
doesn't have holes.</li>
  <li>&nbsp;&nbsp; ExpandVol - adds some extra layers of voxels at the
surface of the object. This module should be used only if the object
has very thin regions (1,
or 2 voxels thick). <span style="font-weight: bold;">!!!</span> Adding
layers of extra voxels at the surface of the object will smooth
the object, and possibly merge some features that are very close
together. <span style="font-weight: bold;">!!!</span></li>
  <li>&nbsp;&nbsp; PotField - computes the vector field for the object</li>
  <li>&nbsp;&nbsp; CritPts - finds the critical points of the object's
vector
field.</li>
  <li>&nbsp;&nbsp; HighDiverg - finds the highest negative divergence
points
of the object's vector field.</li>
  <li>&nbsp;&nbsp; StreamLn - follows the streamlines of the vector
field,
starting at the critical and high divergence points and builds the
skeleton.</li>
</ol>
Usually, the last 2 modules will be run multiple times to adjust the
number of high divergence points to use for skeleton generation.<br>
<br>
<br>
<h2><a name="Saving"></a>5. Saving/Loading the Potential Field to/from
a File</h2>
<br>
&nbsp;&nbsp; Computing the potential field of the 3D object takes most
of the total running time of the algorithm. Once you decided on a field
strength,
you can save the computed potential field to a file by using the
<span style="font-style: italic;">-vectorfieldoutputfile</span> option
of the pfSkel program. <br>
&nbsp;&nbsp; The saved potential field can then be loaded on the next
run of pfSkel using the <span style="font-style: italic;">-vectorfieldinputfile</span>
option and it will not be computed again,
saving you a lot of time.<br>
<span style="font-weight: bold;">!!! </span><br>
A potential field has 3 float values for each voxel in the dataset.
Thus, the generated file will be about 3*8 (24) times bigger than the
volume
dataset. (actually more than that since it is a ASCII file and uses
separators
between values). <br>
<span style="font-weight: bold;">!!!</span><br>
<br>
<br>
<h2><a name="Contact"></a>6. Contact Info</h2>
<br>
Nicu D. Cornea<br>
Electrical and Computer Engineering Department<br>
Rutgers, The State University of New Jersey<br>
Piscataway, NJ 08854<br>
e-mail: cornea@caip.rutgers.edu<br>
<br>
</body>
</html>
